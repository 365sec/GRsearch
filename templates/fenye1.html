<!DOCTYPE html >
<html xmlns="http://www.w3.org/1999/xhtml">
	{% load staticfiles %}
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=emulateIE7"/>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
		<title>365sec</title>
		<link href="{% static 'css/style.css' %}" rel="stylesheet" type="text/css"/>
		<link href="{% static 'css/result.css' %}" rel="stylesheet" type="text/css"/>
	</head>
	<body>
		<div id="container">
			<div id="hd" class="ue-clear">
				<a href="/"> <div class="logo"></div> </a>
				<div class="inputArea">
					<input type="text" class="searchInput" value="{{ search_content }}"/>
					<input type="button" class="searchButton" value="搜索" onclick="add_search()"/>
				</div>
			</div>
			<div class="nav">
				<ul class="searchList">
					<li class="searchItem {% ifequal s_type 'webscan' %}current{% endifequal %}" data-type="webscan">
						webscan
					</li>
					<li class="searchItem {% ifequal s_type 'portscan' %}current{% endifequal %}" data-type="portscan">
						portscan
					</li>
					<li class="searchItem {% ifequal s_type 'ipv4' %}current{% endifequal %}" data-type="ipv4">
						ipv4
					</li>
					<li class="searchItem {% ifequal s_type 'waf' %}current{% endifequal %}" data-type="waf">
						waf
					</li>
				</ul>
			</div>
			<div id="bd" class="ue-clear">
				<div id="main">
					<div class="sideBar">

						<div class="subfield">
							统计
						</div>
						<ul class="subfieldContext">
							<li>
								<span class="name">高危网站top5</span>
								<span class="unit">(具体功能待定)</span>
							</li>

						</ul>
						<div class="sideBarShowHide">
							<a href="javascript:;" class="icon"></a>
						</div>
					</div>
					<div class="resultArea">
						<p class="resultTotal">
							<span class="info">&nbsp;<span class="totalResult">{{ total_nums }}</span>&nbsp;条结果(用时<span
								class="time">{{ time_took }}</span>秒)，共约<span
								class="totalPage">{{ page_nums }}</span>页</span>
						</p>
						<div class="resultList" style="">
							{% for hit in all_hits %}
							<div class="resultItem">
								<div class="itemHead">
									<a href="{{ hit.url }}" target="_blank" class="title"> {% autoescape off %}{{ hit.site }}{% endautoescape %}</a>
									<span class="divsion">-</span>
									<span class="fileType"> <span class="label">来源：</span> <span class="value">webscan</span> </span>
									<span class="dependValue"> <span class="label">安全评分：</span> <span class="value">{{ hit.grade }}</span> </span>
								</div>
								<div class="itemBody">
									{% autoescape off %}{{ hit.result }}{% endautoescape %}
								</div>
							</div>
							{% endfor %}
						</div>
						<!-- 分页 -->


						<div class="pagination ue-clear">
							{% ifnotequal page 1 %}
							<a href="{% url 'scan' %}?q={{ search_content }}&page=1&s_type={{ s_type }}">首页</a>
							<a href="{% url 'scan' %}?q={{ search_content }}&page={{ last_page }}&s_type={{ s_type }}">&nbsp;&lt;&nbsp;</a>
							{% endifnotequal %}
							{% for p in page_list %}
							{% if p %}
							{% ifequal page p %}
							<a style="color:#023054;border-color:#8EB2D2;background:#B8DFFB;">{{ p }}</a>
							{% else %}
							{% ifequal p current_page%}
							<strong><span>{{ p }}</span></strong>
							{% endifequal %}
							{% ifnotequal p current_page  %}
							<a href="{% url 'scan' %}?q={{ search_content }}&page={{ p }}&s_type={{ s_type }}" class="page">{{ p }}</a>
							{% endifnotequal %}
							{% endifequal %}
							{% endif %}
							{% endfor %}
							{% ifnotequal page page_nums %}
							<a href="{% url 'scan' %}?q={{ search_content }}&page={{ next_page }}&s_type={{ s_type }}">&nbsp;>&nbsp;</a>
							<a href="{% url 'scan' %}?q={{ search_content }}&page={{ page_nums }}&s_type={{ s_type }}">尾页</a>
							{% endifnotequal %}
						</div>
					</div>
					<div class="historyArea">
						<div class="hotSearch">
							<h6>热门搜索</h6>
							<ul class="historyList">

								<li>
									<a href="/search?q=xss" style="font-size:15px;">xss</a>
								</li>

							</ul>
						</div>
						<div class="mySearch">
							<h6>我的搜索</h6>
							<ul class="historyList">

							</ul>
						</div>
					</div>
				</div><!-- End of main -->
			</div><!--End of bd-->
		</div>

	</body>
	<script type="text/javascript" src="{% static 'js/jquery.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/global.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/pagination.js' %}"></script>
	<script type="text/javascript">
		var search_url = "{% url 'scan' %}";

		$('.searchList').on('click', '.searchItem', function() {
			$('.searchList .searchItem').removeClass('current');
			$(this).addClass('current');
		});

		$.each($('.subfieldContext'), function(i, item) {
			$(this).find('li:gt(2)').hide().end().find('li:last').show();
		});

		function removeByValue(arr, val) {
			for (var i = 0; i < arr.length; i++) {
				if (arr[i] == val) {
					arr.splice(i, 1);
					break;
				}
			}
		}


		$('.subfieldContext .more').click(function(e) {
			var $more = $(this).parent('.subfieldContext').find('.more');
			if ($more.hasClass('show')) {

				if ($(this).hasClass('define')) {
					$(this).parent('.subfieldContext').find('.more').removeClass('show').find('.text').text('自定义');
				} else {
					$(this).parent('.subfieldContext').find('.more').removeClass('show').find('.text').text('更多');
				}
				$(this).parent('.subfieldContext').find('li:gt(2)').hide().end().find('li:last').show();
			} else {
				$(this).parent('.subfieldContext').find('.more').addClass('show').find('.text').text('收起');
				$(this).parent('.subfieldContext').find('li:gt(2)').show();
			}

		});

		$('.sideBarShowHide a').click(function(e) {
			if ($('#main').hasClass('sideBarHide')) {
				$('#main').removeClass('sideBarHide');
				$('#container').removeClass('sideBarHide');
			} else {
				$('#main').addClass('sideBarHide');
				$('#container').addClass('sideBarHide');
			}

		});

		setHeight();
		$(window).resize(function() {
			setHeight();
		});

		function setHeight() {
			if ($('#container').outerHeight() < $(window).height()) {
				$('#container').height($(window).height() - 33);
			}
		}
	</script>
	<script type="text/javascript">
		$('.searchList').on('click', '.searchItem', function() {
			$('.searchList .searchItem').removeClass('current');
			$(this).addClass('current');
		});

		// 联想下拉显示隐藏
		$('.searchInput').on('focus', function() {
			$('.dataList').show();
		});

		// 联想下拉点击
		$('.dataList').on('click', 'li', function() {
			var text = $(this).text();
			$('.searchInput').val(text);
			$('.dataList').hide();
		});

		hideElement($('.dataList'), $('.searchInput'));
	</script>
	<script>
		var searchArr;
		//定义一个search的，判断浏览器有无数据存储（搜索历史）
		if (localStorage.search) {
			//如果有，转换成 数组的形式存放到searchArr的数组里（localStorage以字符串的形式存储，所以要把它转换成数组的形式）
			searchArr = localStorage.search.split(",");
		} else {
			//如果没有，则定义searchArr为一个空的数组
			searchArr = [];
		}
		//把存储的数据显示出来作为搜索历史
		MapSearchArr();

		function add_search() {
			var val = $(".searchInput").val();
			if (val.length >= 2) {
				//点击搜索按钮时，去重
				KillRepeat(val);
				//去重后把数组存储到浏览器localStorage
				localStorage.search = searchArr;
				//然后再把搜索内容显示出来
				MapSearchArr();
			}
			window.location.href = search_url + '?q=' + val + "&s_type=" + $(".searchItem.current").attr('data-type');
		}


		$('.searchInput').keyup(function(e) {
			if (e.keyCode == 13) {//模拟点击搜索按钮，触发上面的 Click 事件
				add_search();
			}
		});

		function MapSearchArr() {
			var tmpHtml = "";
			var arrLen = 0;
			if (searchArr.length > 6) {
				arrLen = 6;
			} else {
				arrLen = searchArr.length;
			}
			for (var i = 0; i < arrLen; i++) {
				tmpHtml += '<li><a href="/scan?q=' + searchArr[i] + '&s_type={{ s_type }}" style="font-size:15px;">' + searchArr[i] + '</a></li>';
			}
			$(".mySearch .historyList").append(tmpHtml);
		}

		//去重
		function KillRepeat(val) {
			var kill = 0;
			for (var i = 0; i < searchArr.length; i++) {
				if (val === searchArr[i]) {
					kill++;
				}
			}
			if (kill < 1) {
				searchArr.unshift(val);
			} else {
				removeByValue(searchArr, val);
				searchArr.unshift(val);
			}
		}
	</script>
</html>